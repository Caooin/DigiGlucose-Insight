# Python 虚拟环境使用指南

## 📚 什么是虚拟环境？

虚拟环境（Virtual Environment）是一个独立的 Python 运行环境，用于隔离不同项目的依赖包。每个项目可以有自己的虚拟环境，避免包版本冲突。

## 🚀 创建虚拟环境（首次使用）

### Windows PowerShell

```powershell
# 1. 进入后端目录
cd "Health Management\backend"

# 2. 创建虚拟环境（.venv 是虚拟环境文件夹名）
python -m venv .venv

# 3. 激活虚拟环境
.\.venv\Scripts\Activate.ps1
```

**如果遇到执行策略错误**：
```powershell
# 允许运行本地脚本（仅当前用户）
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Windows CMD

```cmd
# 1. 进入后端目录
cd "Health Management\backend"

# 2. 创建虚拟环境
python -m venv .venv

# 3. 激活虚拟环境
.venv\Scripts\activate.bat
```

### macOS / Linux

```bash
# 1. 进入后端目录
cd "Health Management/backend"

# 2. 创建虚拟环境
python3 -m venv .venv

# 3. 激活虚拟环境
source .venv/bin/activate
```

## ✅ 验证虚拟环境已激活

激活成功后，命令行提示符前会显示 `(.venv)`：

```powershell
(.venv) PS C:\Users\...\backend>
```

## 📦 安装项目依赖

```powershell
# 确保虚拟环境已激活（看到 (.venv) 前缀）

# 升级 pip（推荐）
python -m pip install --upgrade pip

# 安装项目依赖
pip install -r requirements.txt
```

## 🔄 日常使用流程

### 每次开发前

```powershell
# 1. 进入后端目录
cd "Health Management\backend"

# 2. 激活虚拟环境
.\.venv\Scripts\Activate.ps1

# 3. 运行项目
python -m uvicorn app.main:app --reload
```

### 完成后退出

```powershell
# 退出虚拟环境
deactivate
```

## 📋 常用命令

### 查看已安装的包

```powershell
pip list
```

### 查看项目依赖

```powershell
pip freeze > requirements.txt
```

### 安装新包

```powershell
# 安装单个包
pip install 包名

# 安装并更新 requirements.txt
pip install 包名
pip freeze > requirements.txt
```

### 卸载包

```powershell
pip uninstall 包名
```

## 🐛 常见问题

### Q1: 找不到 python 命令？

**解决方案**：
- 确保已安装 Python 3.8+
- 检查 Python 是否添加到系统 PATH
- 尝试使用 `python3` 代替 `python`

### Q2: PowerShell 无法激活虚拟环境？

**错误信息**：
```
无法加载文件 ...\Activate.ps1，因为在此系统上禁止运行脚本
```

**解决方案**：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Q3: 虚拟环境激活后，pip 安装的包找不到？

**可能原因**：
- 虚拟环境未正确激活
- 在错误的虚拟环境中安装

**解决方案**：
1. 确认命令行提示符前有 `(.venv)` 前缀
2. 检查 `pip` 路径：`where pip`（应该指向 `.venv\Scripts\pip.exe`）

### Q4: 如何删除虚拟环境？

```powershell
# 1. 先退出虚拟环境
deactivate

# 2. 删除 .venv 文件夹
Remove-Item -Recurse -Force .venv
```

### Q5: 虚拟环境可以提交到 Git 吗？

**不可以！** 虚拟环境文件夹（`.venv/`）已在 `.gitignore` 中忽略。

**原因**：
- 体积大（几百 MB）
- 包含系统特定文件
- 可以通过 `requirements.txt` 重新创建

## 📝 最佳实践

1. **每个项目一个虚拟环境**：不同项目使用不同的虚拟环境
2. **激活后再操作**：安装包或运行项目前，确保虚拟环境已激活
3. **定期更新依赖**：定期运行 `pip install --upgrade -r requirements.txt`
4. **保持 requirements.txt 更新**：安装新包后，更新 `requirements.txt`

## 🔗 相关文档

- [Python 官方文档 - venv](https://docs.python.org/3/library/venv.html)
- [项目 README](./README.md)

